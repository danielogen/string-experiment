{% extends "base.html" %} 
{% block title %}Home{% endblock %} 

{% block content %}
<div class="container">
    <br>
    <!-- <h1>Literal String Interpolation Experiment</h1>
    <p>String interpolation allows you to embed expressions into string literals, 
        making it easier to include variables, expressions, 
        or functions within a string. In this exercise, you will encounter different possible 
        permutations of string interpolation syntax. <b>Your task is to select "A" or "B" as 
        quickly as possible to indicate whether you think the code snippet is correct or not. Use the UP ARROW KEY FOR "A" and DOWN ARROW KEY FOR "B".
      To navigate to the next task, use the RIGHT ARROW KEY</b>.
    </p> -->
    
    <!-- Demographic information -->
    <div id="demog">
    <h3>Demographic Information</h3>
    <div class="row">
        <div class="col-md-6">
            <label for="age">How old are you?</label>
            
            <input type="number" min="18" max="150" class="form-control" required id="age" name="age">
        </div>
        <div class="col-md-6">
            <label for="gender">What is you gender?</label>
            <select class="form-control" id="gender" name="gender" required>
                <option value="None">....</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Female">Non-binary</option>
                <option value="Others">Prefer Not to Say</option>
            </select>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col-md-6">
            <label for="programmingYear">College Year:</label>
            <select class="form-control" id="COY" name="COY">
                <option value="Freshman">...</option>
                <option value="Freshman">Freshman</option>
                <option value="Sophomore">Sophomore</option>
                <option value="Junior">Junior</option>
                <option value="Senior">Senior</option>
                <option value="Senior">Graduate</option>
                <!-- <option value="Professional">Professional</option> -->
                <!-- Add more options as needed -->
            </select>
        </div>
        <div class="col-md-6">
            <label for="YearOfProgramming">Years of Computer Programming Experience:</label>
            <select class="form-control" id="YOE" name="YOE">
                <option value="None">...</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5+</option>
            </select>
        </div>
    </div>
    </div>
    <br />
    <!-- Start button -->
    <input type="submit" id="startBtn" class="btn btn-success" value="Next >>"> 
    
    <div id="questionContainer" style="display: none;">
      <h1>Practice Tasks</h1>
      Before you start the actual experiment, we thought it is a good idea to practice with a few tasks. There are four tasks and you can repeat as many times as you need. The symbol <b>"+"</b> is for concatenation and <b>"{ }"</b> for interpolation (embedding). Read the task and select <b>THE OPTION YOU THINK IS CORRECT</b> by pressing <b>1, 2, 3 or 4</b>. Once you feel confident to start the actual experiment, click <b>"PROCEED"</b> at the button right corner of practice task 4 or press <b>"ENTER / RETURN"</b> key on your keyboard. To repeat the task, simply press <b>RIGHT ARROW KEY</b>.
      <br />
      <br />
      <div id="question1" class="question" style="display: none;">
        <h4>Task 1 of 4: The "+" symbol is for concatenation. Press 1, 2, 3 or 4 to select the correct concatenation. </h4>
        <!-- c = 4 * 3 -->
        <!-- ("....." + a * b + ".....") -->
          <pre>
              <code>
                a = "Hello "
                b = "World"

                a + b
              </code>
          </pre>
          <!-- A. "....." + 4 * 3 + "....." -->
          <!-- B. "....." + ${4 * 3} + "....." -->
          Options: <br />
          &nbsp;&nbsp;1. "HelloWorld" <br />
          &nbsp;&nbsp;2. "Hello World" <br />
          &nbsp;&nbsp;3. "World " <br />
          &nbsp;&nbsp;4. "There" <br />
          <input type="hidden" value="Concatenated" id="Concatenated" />
          <input type="hidden" class="btn btn-success next-btn" data-next="question2" />
      </div>
      <div id="question2" class="question" style="display: none;">
        <h4>Task 2 of 4: The "{ }" symbol is for interpolation. Press 1, 2, 3 or 4 to select the correct interpolation.</h4>
        <pre>
          <code>
            a = "Hello "
            b = "World"

            "{b}{a}"
          </code>
      </pre>
      <!-- A. "....." + 4 * 3 + "....." -->
      <!-- B. "....." + ${4 * 3} + "....." -->
      Options: <br />
      &nbsp;&nbsp;1. "World Hello" <br />
      &nbsp;&nbsp;2. "Hello World" <br />
      &nbsp;&nbsp;3. "World " <br />
      &nbsp;&nbsp;4. "There" <br />
      <input type="hidden" value="Concatenated" id="Concatenated" />
      <input type="hidden" class="btn btn-success next-btn" data-next="question3" />
    </div>
    <div id="question3" class="question" style="display: none;">
      <h4>Task 3 of 4: The "+" symbol is for concatenation. Press 1, 2, 3 or 4 to select the correct concatenation.</h4>
      <!-- "....." + |a * b| + "...." + |c|+ "...." -->
      <!-- B. |....." + a * b + "...." + c + "..| -->
      <pre>
          <code>
              a = "Hi"
              b = "There"
              c = 4

               c + b + a
          </code>
      </pre>
      Options: <br />
      &nbsp;&nbsp;1. "Hi There 4" <br />
      &nbsp;&nbsp;2. "Hi 4 There" <br />
      &nbsp;&nbsp;3. "4 There Hi " <br />
      &nbsp;&nbsp;4. "There 4 Hi" <br />
      <input type="hidden" value="Concatenated" id="Concatenated" />
      <input type="hidden" class="btn btn-success next-btn" data-next="question4" />
  </div>
  <div id="question4" class="question" style="display: none;">
    <h4>Task 4 of 4: The "{ }" symbol is for interpolation. Press 1, 2, 3 or 4 to select the correct interpolation.</h4>
    <pre>
        <code>
            a = 30
            b = 15
            c = 4 * 3

            "....." + a * b| + "...." + c|+ "...."
        </code>
    </pre>
  
    <p align="right">
      <br>
      <button type="button" class="btn btn-warning next-btn" data-next="question1">Try Again</button>
      <a href="{{ url_for('experiment') }}"><button type="button" class="btn btn-success next-btn" data-next="submitPage">Proceed</button></a>
    </p>
  </form>
  </div>
  

<!-- Bootstrap JS (optional, if you need JavaScript features) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  // $(document).ready(function(){
  //   $('#startBtn').click(function(e){
  //     let gender = $("#gender").val();
  //     if(gender == 'None'){
  //       e.preventDefault()
  //       alert("Gender Cannot be None")
        
  //     }
  //   })
    
  // })
  document.addEventListener('DOMContentLoaded', function() {
    const questionDivs = document.querySelectorAll('.question');
    const nextButtons = document.querySelectorAll('.next-btn');
    const submitPage = document.getElementById('submitPage');
    const startBtn = document.getElementById('startBtn');
    const demogDiv = document.getElementById('demog');
    const questionContainer = document.getElementById('questionContainer');
    let taskStart; // Variable to store the start time of each task
    let currentTaskNumber = 1; // Variable to store the current task number
    const taskDurations = []; // Array to store task durations
    const taskNumbers = []; // Array to store task numbers
    let age;
    let gender;
    let COY;
    let YOE;

    // Function to handle keyboard navigation
    function handleKeyboardNavigation(event) {
      const currentQuestion = document.querySelector('.question:not([style*="display: none;"])');
      const radioButtons = currentQuestion.querySelectorAll('input[type="radio"]');
      const selectedRadioButton = currentQuestion.querySelector('input[type="radio"]:checked');

      if (event.key === 'ArrowUp') {
        if (selectedRadioButton) {
          selectedRadioButton.checked = false;
        }
        radioButtons[0].checked = true; // Select "Yes" option
      } else if (event.key === 'ArrowDown') {
        if (selectedRadioButton) {
          selectedRadioButton.checked = false;
        }
        radioButtons[1].checked = true; // Select "No" option
      } else if (event.key === 'ArrowRight') {
        const nextButton = currentQuestion.querySelector('.next-btn');
        nextButton.click(); // Simulate click on the next button
      }
    }

    startBtn.addEventListener('click', function() {
      // Retrieve demographic data
      age = document.getElementById('age').value;
        gender = document.getElementById('gender').value;
        COY = document.getElementById('COY').value; //COY - COllege Year
        YOE = document.getElementById('YOE').value; //YOE = Year of Experience

        // Show the question container and the first question
        questionContainer.style.display = 'block';
        document.getElementById('question1').style.display = 'block';
        // Hide the start button
        startBtn.style.display = 'none';
        demogDiv.style.display = 'none';
        // taskStart = Date.now(); // Record start time for the first task
    });

    nextButtons.forEach(function(button, index) {
      button.addEventListener('click', function() {
        const nextQuestionId = button.getAttribute('data-next');
        const nextQuestion = document.getElementById(nextQuestionId);
        // const selectedOption = nextQuestion.getElementsByName('q1').value;
        // console.log(nextQuestion )

        // Record end time for the completed task
        // const taskEnd = Date.now();
        // Calculate duration of completed task
        // const taskDuration = (taskEnd - taskStart) / 1000; // Convert to seconds
        // taskDurations.push(taskDuration.toFixed(2)); // Store task duration
        // taskNumbers.push(currentTaskNumber); // Store task number
        // selectedOptions.push(selectedOption); // Store selected option

        // Hide current question
        button.closest('.question').style.display = 'none';

        // Show next question or submit page if it's the last question
        if (nextQuestionId === 'submitPage') {
          submitPage.style.display = 'block';
          // Generate and download CSV file with task durations and numbers
          // downloadCSV(gender, age, COY, YOE, taskNumbers,taskDurations);
        } else {
          nextQuestion.style.display = 'block';
          taskStart = Date.now(); // Record start time for the next task
          currentTaskNumber++; // Increment task number
        }
      });
    });

    // Listen for keydown events to handle keyboard navigation
    document.addEventListener('keydown', handleKeyboardNavigation);
  })
</script>
{% endblock %} 